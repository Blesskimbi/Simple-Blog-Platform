<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Post - BlogHub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Focus Mode Toggle -->
    <button class="focus-toggle" id="focusToggle" title="Toggle Focus Mode">üéØ</button>

    <!-- Autosave Indicator -->
    <div class="autosave-indicator" id="autosaveIndicator">
        <span class="autosave-dot"></span>
        <span id="autosaveText">Saved</span>
    </div>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="url(#gradient)" />
                    <path d="M2 17L12 22L22 17" stroke="url(#gradient)" stroke-width="2" />
                    <defs>
                        <linearGradient id="gradient" x1="2" y1="2" x2="22" y2="22">
                            <stop offset="0%" style="stop-color:#6366f1" />
                            <stop offset="100%" style="stop-color:#8b5cf6" />
                        </linearGradient>
                    </defs>
                </svg>
                BlogHub
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item" id="dashboardLink">
                        <a class="nav-link" href="dashboard.html">Dashboard</a>
                    </li>
                    <li class="nav-item ms-3">
                        <div class="theme-switch" onclick="toggleTheme()">
                            <span id="themeIcon">‚òÄÔ∏è</span>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Create Post Section -->
    <section class="container py-5" style="margin-top: 80px;">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card shadow-sm">
                    <div class="card-header bg-white p-4 border-0">
                        <h1 class="h3 mb-0">Create New Post</h1>
                    </div>
                    <div class="card-body p-4">
                        <div id="draftRecoveryBanner"></div>
                        <div id="alertContainer"></div>
                        <form id="richPostForm">
                            <!-- Customization Section -->
                            <div class="post-customization-options mb-4">
                                <div class="row align-items-center">
                                    <div class="col-md-4">
                                        <button type="button" class="btn btn-outline-secondary w-100 mb-2 mb-md-0" onclick="triggerCoverInput()">
                                            üñºÔ∏è Add Layout Cover
                                        </button>
                                        <input type="text" id="coverUrlInput" class="form-control form-control-sm mt-1 d-none" placeholder="Paste image URL here...">
                                    </div>
                                    <div class="col-md-4">
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text bg-transparent">üé® Theme</span>
                                            <select id="themeColorSelect" class="form-select">
                                                <option value="var(--accent)">Default</option>
                                                <option value="#ec4899">Pink</option>
                                                <option value="#10b981">Emerald</option>
                                                <option value="#f59e0b">Amber</option>
                                                <option value="#3b82f6">Blue Bird</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text bg-transparent">üî§ Font</span>
                                            <select id="typographySelect" class="form-select" onchange="updateEditorTypography()">
                                                <option value="'Inter', sans-serif">Modern Sans</option>
                                                <option value="'Georgia', serif">Classic Serif</option>
                                                <option value="'JetBrains Mono', monospace">Monospace</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div id="coverPreviewContainer" class="mt-3 d-none">
                                    <img id="coverPreview" src="" class="post-cover-preview" alt="Cover preview">
                                    <button type="button" class="btn btn-sm btn-danger mt-1" onclick="removeCover()">Remove Cover</button>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="postTitle" class="form-label">Title</label>
                                <div id="postTitle" class="form-control form-control-lg" contenteditable="true" data-placeholder="Enter an engaging title"></div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="postContent" class="form-label">Content</label>
                                <div class="editor-container">
                                    <div class="editor-sidebar">
                                        <button type="button" class="btn-plus" id="toggleTools" aria-label="Add content">
                                            <span>+</span>
                                        </button>
                                        <div class="tools-menu" id="toolsMenu">
                                            <button type="button" class="tool-btn" onclick="triggerUpload('image')" title="Add Image">üì∑</button>
                                            <button type="button" class="tool-btn" onclick="triggerUpload('video')" title="Add Video">üé•</button>
                                            <button type="button" class="tool-btn" onclick="triggerUpload('audio')" title="Add Audio">üéµ</button>
                                            <button type="button" class="tool-btn" onclick="insertContent('link')" title="Add Link">üîó</button>
                                            <button type="button" class="tool-btn" onclick="insertContent('embed')" title="Add Embed">üîå</button>
                                        </div>
                                    </div>
                                    <div id="editor" class="editor-content" contenteditable="true" data-placeholder="Tell your story..."></div>
                                    
                                    <!-- Hidden File Inputs -->
                                    <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                                    <input type="file" id="videoUpload" accept="video/*" style="display: none;">
                                    <input type="file" id="audioUpload" accept="audio/*" style="display: none;">
                                </div>
                                
                                <!-- Floating Formatting Toolbar -->
                                <div id="formatToolbar" class="formatting-toolbar">
                                    <button type="button" class="format-btn" data-cmd="bold" title="Bold"><strong>B</strong></button>
                                    <button type="button" class="format-btn" data-cmd="italic" title="Italic"><em>I</em></button>
                                    <button type="button" class="format-btn" data-cmd="strikeThrough" title="Strikethrough"><s>S</s></button>
                                    <button type="button" class="format-btn" data-cmd="h2" title="Heading">H2</button>
                                    <button type="button" class="format-btn" data-cmd="h3" title="Subheading">H3</button>
                                    <button type="button" class="format-btn" data-cmd="blockquote" title="Quote">""</button>
                                    <button type="button" class="format-btn" data-cmd="insertLink" title="Insert Link">üîó</button>
                                    <button type="button" class="format-btn" data-cmd="removeFormat" title="Clear Format">üßπ</button>
                                    <button type="button" class="format-btn" id="colorBtn" title="Color">üé®</button>
                                    <input type="color" id="colorInput" class="color-input-hidden">
                                    <div class="format-btn-group" style="position:relative;">
                                        <button type="button" class="format-btn" id="codeBlockBtn" title="Code Block">&lt;/&gt;</button>
                                        <div class="code-lang-dropdown" id="codeLangDropdown">
                                            <button type="button" data-lang="javascript">JavaScript</button>
                                            <button type="button" data-lang="python">Python</button>
                                            <button type="button" data-lang="html">HTML</button>
                                            <button type="button" data-lang="css">CSS</button>
                                            <button type="button" data-lang="java">Java</button>
                                            <button type="button" data-lang="cpp">C++</button>
                                            <button type="button" data-lang="plaintext">Plain Text</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="d-flex justify-content-between align-items-center mt-4">
                                <a href="dashboard.html" class="btn btn-outline-secondary">Cancel</a>
                                <button type="submit" class="btn btn-primary btn-lg px-4" id="submitBtn">
                                    Publish Post
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer mt-auto">
        <div class="container text-center py-4">
            <p>&copy; 2024 BlogHub. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="script.js"></script>
    <script>
        // Initialize
        // checkAuthAccess(); // Removed as it's handled by script.js checkAuth()
        
        const toggleBtn = document.getElementById('toggleTools');
        const toolsMenu = document.getElementById('toolsMenu');
        const editor = document.getElementById('editor');
        const formatToolbar = document.getElementById('formatToolbar');

        // Toggle Tools Menu
        toggleBtn.addEventListener('click', () => {
            toggleBtn.classList.toggle('active');
            toolsMenu.classList.toggle('active');
        });

        // Trigger Hidden File Inputs
        function triggerUpload(type) {
            const inputId = `${type}Upload`;
            const input = document.getElementById(inputId);
            if (input) input.click();
        }

        // Handle File Uploads
        ['image', 'video', 'audio'].forEach(type => {
            const input = document.getElementById(`${type}Upload`);
            input.addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                // Show loading state in button
                const btn = document.querySelector(`.tool-btn[onclick="triggerUpload('${type}')"]`);
                const originalText = btn.innerHTML;
                btn.innerHTML = '‚è≥';
                
                try {
                    const fileExt = file.name.split('.').pop();
                    const fileName = `${Date.now()}.${fileExt}`;
                    const filePath = `${fileName}`;

                    // Upload to Supabase using new client name
                    const { data, error } = await supabaseClient.storage
                        .from('media') // Ensure bucket exists
                        .upload(filePath, file);

                    if (error) throw error;

                    // Get Public URL
                    const { data: publicData } = supabaseClient.storage
                        .from('media')
                        .getPublicUrl(filePath);

                    const publicUrl = publicData.publicUrl;
                    insertMedia(type, publicUrl);

                    showAlert(`${type.charAt(0).toUpperCase() + type.slice(1)} uploaded successfully!`, 'success');
                } catch (error) {
                    console.error('Upload error:', error);
                    alert('Error uploading file: ' + error.message);
                } finally {
                    btn.innerHTML = originalText;
                    input.value = ''; // Reset input
                    // Close menu
                    toggleBtn.classList.remove('active');
                    toolsMenu.classList.remove('active');
                }
            });
        });

        function insertMedia(type, url) {
            let html = '';
            if (type === 'image') {
                html = `<img src="${url}" class="img-fluid rounded my-3" alt="Uploaded Image">`;
            } else if (type === 'video') {
                html = `<video src="${url}" controls class="w-100 rounded my-3"></video>`;
            } else if (type === 'audio') {
                html = `<audio src="${url}" controls class="w-100 my-3"></audio>`;
            }
            execCmd('insertHTML', html);
        }

        function insertContent(type) {
             if (type === 'link') {
                 const url = prompt('Please paste the URL of the link you want to add:');
                 if (url) {
                    const text = prompt('Enter the text to display for this link:', 'Click here');
                    if (text) {
                        const html = `<a href="${url}" target="_blank" class="text-primary text-decoration-underline">${text}</a>`;
                        execCmd('insertHTML', html);
                    }
                 }
             } else if (type === 'embed') {
                 const code = prompt('Please paste the embed code (e.g. from YouTube, Twitter, etc.):');
                 if (code) execCmd('insertHTML', `<div class="embed-responsive my-3 text-center">${code}</div><p><br></p>`);
             }
             toggleBtn.classList.remove('active');
             toolsMenu.classList.remove('active');
        }

        // --- Formatting Toolbar Handling ---

        // Make toolbar parent relative for positioning
        formatToolbar.parentElement.style.position = 'relative';

        document.addEventListener('selectionchange', () => {
            const selection = window.getSelection();

            if (!editor.contains(selection.anchorNode)) {
                 formatToolbar.classList.remove('active');
                 return;
            }

            if (selection.toString().length > 0) {
                const range = selection.getRangeAt(0);
                const rect = range.getBoundingClientRect();
                const containerRect = editor.parentElement.getBoundingClientRect();
                const top = rect.top - containerRect.top - 50;
                const left = rect.left - containerRect.left + (rect.width / 2) - (formatToolbar.offsetWidth / 2);

                formatToolbar.style.top = `${top}px`;
                formatToolbar.style.left = `${Math.max(0, left)}px`;
                formatToolbar.classList.add('active');

                // Update active states on format buttons
                document.querySelectorAll('.format-btn[data-cmd]').forEach(btn => {
                    const cmd = btn.dataset.cmd;
                    if (cmd === 'bold' || cmd === 'italic' || cmd === 'strikeThrough') {
                        btn.classList.toggle('is-active', document.queryCommandState(cmd));
                    }
                });
            } else {
                formatToolbar.classList.remove('active');
            }
        });

        // Toolbar Buttons
        document.querySelectorAll('.format-btn[data-cmd]').forEach(btn => {
            btn.addEventListener('mousedown', (e) => {
                const cmd = btn.dataset.cmd;
                if (!cmd) return;
                e.preventDefault();

                if (cmd === 'h2') {
                    document.execCommand('formatBlock', false, 'h2');
                } else if (cmd === 'h3') {
                    document.execCommand('formatBlock', false, 'h3');
                } else if (cmd === 'blockquote') {
                    document.execCommand('formatBlock', false, 'blockquote');
                } else if (cmd === 'insertLink') {
                    // Save selection before prompt
                    const sel = window.getSelection();
                    let linkRange = null;
                    if (sel.rangeCount > 0) linkRange = sel.getRangeAt(0).cloneRange();
                    const selectedText = sel.toString();

                    const url = prompt('Enter URL:', 'https://');
                    if (url && url !== 'https://') {
                        // Restore selection
                        if (linkRange) {
                            sel.removeAllRanges();
                            sel.addRange(linkRange);
                        }
                        if (selectedText) {
                            document.execCommand('createLink', false, url);
                            // Make links open in new tab
                            setTimeout(() => {
                                editor.querySelectorAll('a:not([target])').forEach(a => {
                                    a.setAttribute('target', '_blank');
                                    a.setAttribute('rel', 'noopener noreferrer');
                                });
                            }, 50);
                        } else {
                            const linkText = prompt('Enter link text:', 'Click here');
                            if (linkText) {
                                const html = `<a href="${url}" target="_blank" rel="noopener noreferrer">${linkText}</a>`;
                                document.execCommand('insertHTML', false, html);
                            }
                        }
                    }
                } else if (cmd === 'removeFormat') {
                    document.execCommand('removeFormat', false, null);
                    document.execCommand('unlink', false, null);
                    document.execCommand('formatBlock', false, 'p');
                } else {
                    document.execCommand(cmd, false, null);
                }
            });
        });

        // Color Picker ‚Äî fixed
        const colorBtn = document.getElementById('colorBtn');
        const colorInput = document.getElementById('colorInput');
        let savedSelection = null;

        colorBtn.addEventListener('mousedown', (e) => {
             e.preventDefault();
             const sel = window.getSelection();
             if (sel.rangeCount > 0) {
                 savedSelection = sel.getRangeAt(0).cloneRange();
             }
             setTimeout(() => colorInput.click(), 10);
        });

        colorInput.addEventListener('change', (e) => {
            if (savedSelection) {
                const sel = window.getSelection();
                sel.removeAllRanges();
                sel.addRange(savedSelection);
            }
            document.execCommand('foreColor', false, e.target.value);
            savedSelection = null;
        });

        // Code Block ‚Äî dropdown
        const codeBlockBtn = document.getElementById('codeBlockBtn');
        const codeLangDropdown = document.getElementById('codeLangDropdown');

        codeBlockBtn.addEventListener('mousedown', (e) => {
            e.preventDefault();
            codeLangDropdown.classList.toggle('show');
        });

        codeLangDropdown.querySelectorAll('button').forEach(langBtn => {
            langBtn.addEventListener('mousedown', (e) => {
                e.preventDefault();
                const lang = langBtn.dataset.lang;
                const html = `<div class="code-block" data-lang="${lang}" contenteditable="false"><div class="code-block-header"><span>${lang}</span><button onclick="this.parentElement.parentElement.remove()" class="code-block-remove">&times;</button></div><pre><code contenteditable="true">// Write your ${lang} code here...</code></pre></div><p><br></p>`;
                editor.focus();
                document.execCommand('insertHTML', false, html);
                codeLangDropdown.classList.remove('show');
                formatToolbar.classList.remove('active');
            });
        });

        // Close dropdown on outside click
        document.addEventListener('click', (e) => {
            if (!codeBlockBtn.contains(e.target) && !codeLangDropdown.contains(e.target)) {
                codeLangDropdown.classList.remove('show');
            }
        });

        // Ensure editor sidebar doesn't block clicks
        document.querySelector('.editor-sidebar').style.pointerEvents = 'none';
        document.getElementById('toggleTools').style.pointerEvents = 'auto';
        document.getElementById('toolsMenu').style.pointerEvents = 'auto';


        function execCmd(command, value = null) {
            document.execCommand(command, false, value);
            editor.focus();
        }

        // Handle Enter key to break out of quotes and formatting
        editor.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) { // Shift+Enter for soft break
                e.preventDefault();
                // Insert new paragraph
                document.execCommand('insertParagraph', false, null);
                // Force it to be a plain paragraph, breaking out of blockquotes/headers
                document.execCommand('formatBlock', false, 'p');
                // Remove formatting from the new line
                document.execCommand('removeFormat', false, null);
                document.execCommand('unlink', false, null);
                // Also explicitly turn off bold/italic if they persist (sometimes needed)
                document.execCommand('bold', false, null);
                if (document.queryCommandState('bold')) document.execCommand('bold', false, null);
                if (document.queryCommandState('italic')) document.execCommand('italic', false, null);
            }
        });

        // Handle Form Submission
        document.getElementById('richPostForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            // Get title from contenteditable
            const titleElement = document.getElementById('postTitle');
            const title = titleElement.innerText.trim(); // Use innerText to get plain text or innerHTML if we want rich text title? 
            // User requested "apply the text styling for the post title as well", so we should save innerHTML.
            const titleContent = titleElement.innerHTML; 
            
            const content = editor.innerHTML;

            if (!title || !editor.textContent.trim() && !content.includes('<img')) {
                 showAlert('Please enter a title and some content', 'danger');
                 return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Publishing...';

            try {
                // Get User
                const { data: { user } } = await supabaseClient.auth.getUser();
                const mockUser = JSON.parse(localStorage.getItem('demoUser'));
                const userId = user ? user.id : (mockUser ? mockUser.id : null);

                if (!userId) throw new Error("You must be logged in.");

                const coverUrl = document.getElementById('coverUrlInput').value.trim();
                const themeColor = document.getElementById('themeColorSelect').value;
                const typography = document.getElementById('typographySelect').value;

                const { error } = await supabaseClient
                    .from('posts')
                    .insert([{ 
                        title: titleContent, 
                        content, 
                        user_id: userId,
                        cover_url: coverUrl || null,
                        theme_color: themeColor,
                        typography: typography
                    }]);

                if (error) throw error;

                showAlert('Post published successfully!', 'success');
                localStorage.removeItem('bloghub_draft_create');
                setTimeout(() => window.location.href = 'dashboard.html', 1500);
            } catch (err) {
                console.error('Error:', err);
                showAlert(err.message, 'danger');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Publish Post';
            }
        });

        // ========== FOCUS MODE ==========
        document.getElementById('focusToggle').addEventListener('click', () => {
            document.body.classList.toggle('focus-mode');
        });

        // ========== AUTOSAVE + DRAFT RECOVERY ==========
        const DRAFT_KEY = 'bloghub_draft_create';
        const autosaveIndicator = document.getElementById('autosaveIndicator');
        const autosaveText = document.getElementById('autosaveText');
        let lastSaveTime = null;
        let autosaveTimer = null;
        let elapsedTimer = null;

        function saveDraft() {
            const titleEl = document.getElementById('postTitle');
            const draft = {
                title: titleEl.innerHTML,
                content: editor.innerHTML,
                savedAt: Date.now()
            };
            localStorage.setItem(DRAFT_KEY, JSON.stringify(draft));
            lastSaveTime = Date.now();

            // Show indicator
            autosaveIndicator.classList.add('saving');
            autosaveIndicator.classList.add('visible');
            autosaveText.textContent = 'Saving...';

            setTimeout(() => {
                autosaveIndicator.classList.remove('saving');
                updateElapsed();
            }, 600);
        }

        function updateElapsed() {
            if (!lastSaveTime) return;
            const seconds = Math.floor((Date.now() - lastSaveTime) / 1000);
            if (seconds < 5) {
                autosaveText.textContent = 'Saved just now';
            } else if (seconds < 60) {
                autosaveText.textContent = `Saved ${seconds}s ago`;
            } else {
                const mins = Math.floor(seconds / 60);
                autosaveText.textContent = `Saved ${mins}m ago`;
            }
        }

        // Auto-save every 7 seconds
        function startAutosave() {
            autosaveTimer = setInterval(() => {
                const titleEl = document.getElementById('postTitle');
                if (titleEl.textContent.trim() || editor.textContent.trim()) {
                    saveDraft();
                }
            }, 7000);

            // Update elapsed time display every second
            elapsedTimer = setInterval(updateElapsed, 1000);
        }

        startAutosave();

        // Draft recovery on load
        function checkDraftRecovery() {
            const saved = localStorage.getItem(DRAFT_KEY);
            if (!saved) return;

            try {
                const draft = JSON.parse(saved);
                // Only offer recovery if draft has content and is less than 24h old
                const age = Date.now() - draft.savedAt;
                if (age > 24 * 60 * 60 * 1000) {
                    localStorage.removeItem(DRAFT_KEY);
                    return;
                }

                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = draft.title;
                const titlePreview = tempDiv.textContent.trim();
                if (!titlePreview && !draft.content.replace(/<[^>]*>/g, '').trim()) return;

                const timeSaved = new Date(draft.savedAt).toLocaleString();
                const banner = document.getElementById('draftRecoveryBanner');
                banner.innerHTML = `
                    <div class="draft-recovery-banner">
                        <p>üìÑ You have an unsaved draft${titlePreview ? ': <strong>' + titlePreview + '</strong>' : ''} <small class="text-secondary">(${timeSaved})</small></p>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-primary" onclick="restoreDraft()">Restore</button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="dismissDraft()">Dismiss</button>
                        </div>
                    </div>
                `;
            } catch (e) {
                localStorage.removeItem(DRAFT_KEY);
            }
        }

        function restoreDraft() {
            const saved = localStorage.getItem(DRAFT_KEY);
            if (!saved) return;
            const draft = JSON.parse(saved);
            document.getElementById('postTitle').innerHTML = draft.title || '';
            editor.innerHTML = draft.content || '';
            document.getElementById('draftRecoveryBanner').innerHTML = '';
            showAlert('Draft restored!', 'success');
        }

        function dismissDraft() {
            localStorage.removeItem(DRAFT_KEY);
            document.getElementById('draftRecoveryBanner').innerHTML = '';
        }

        checkDraftRecovery();

        // Clear draft on successful publish
        const originalSubmitHandler = document.getElementById('richPostForm');
        // (Draft is cleared inside the submit success callback below is not needed since
        //  the page redirects on success, but let's clear it to be safe)
        // --- Post Customization Logic ---
        function triggerCoverInput() {
            const input = document.getElementById('coverUrlInput');
            input.classList.toggle('d-none');
            input.focus();
        }

        document.getElementById('coverUrlInput').addEventListener('input', (e) => {
            const url = e.target.value.trim();
            const preview = document.getElementById('coverPreview');
            const container = document.getElementById('coverPreviewContainer');
            if (url) {
                preview.src = url;
                container.classList.remove('d-none');
            } else {
                container.classList.add('d-none');
            }
        });

        function removeCover() {
            document.getElementById('coverUrlInput').value = '';
            document.getElementById('coverPreviewContainer').classList.add('d-none');
        }

        function updateEditorTypography() {
            const font = document.getElementById('typographySelect').value;
            editor.style.fontFamily = font;
            document.getElementById('postTitle').style.fontFamily = font;
        }
    </script>
</body>
</html>
